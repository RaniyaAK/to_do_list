{% extends "master.html" %}
{% load static %}

{% block title %}To Do List{% endblock %}

{% block content %}

<!-- Theme toggle button (only here) -->
<button id="themeToggle" class="theme-toggle">Dark Mode</button>

<h1>To Do List</h1>

<table>
    <tr>
        <th>No.</th>
        <th>Date</th>
        <th>Task</th>
        <th>Status</th>
        <th>Due Date</th>
        <th>Actions</th>
    </tr>
    {% for x in mytasks %}
    <tr>
        <td>{{ x.id }}</td>
        <td>{{ x.created_date }}</td>
        <td>{{ x.task }}</td>

        {% if x.status == "pending" %}
        <td class="pending_btn">{{ x.status }}</td>
        {% else %}
        <td class="completed_btn">{{ x.status }}</td>
        {% endif %}

        <td>
            {{ x.due_date }}
            {% if x.status != "completed" %}
                {% if x.due_date|date:"Y-m-d" == today|date:"Y-m-d" %}
                    <span class="due-today">Due Today</span>
                {% elif x.due_date|date:"Y-m-d" < today|date:"Y-m-d" %}
                    <span class="overdue">Overdue</span>
                {% else %}
                    <span class="pending">Pending</span>
                {% endif %}
            {% endif %}
        </td>

        <td>
            <button class="update_btn"><a href="update_tasks/{{x.id}}">Update</a></button>
            <button class="delete_btn"><a href="delete/{{x.id}}">Delete</a></button>
        </td>
    </tr>
    {% endfor %}
</table>

<button class="add_btn"><a href="/add">+ Add Tasks</a></button>

<!-- Theme toggle JS -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const body = document.body;
    const toggleButton = document.getElementById('themeToggle');

    // Load saved theme
    const savedTheme = localStorage.getItem('theme');
    if(savedTheme){
        body.classList.remove('light-theme','dark-theme');
        body.classList.add(savedTheme);
        toggleButton.textContent = savedTheme === 'dark-theme' ? 'Light Mode' : 'Dark Mode';
    }

    toggleButton.addEventListener('click', () => {
        body.classList.toggle('dark-theme');
        body.classList.toggle('light-theme');

        const currentTheme = body.classList.contains('dark-theme') ? 'dark-theme' : 'light-theme';
        localStorage.setItem('theme', currentTheme);

        toggleButton.textContent = currentTheme === 'dark-theme' ? 'Light Mode' : 'Dark Mode';
    });
});
</script>

{% endblock %}
